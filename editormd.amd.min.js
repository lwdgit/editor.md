/*! Editor.md v1.5.0 | editormd.amd.min.js | Open source online markdown editor. | MIT License | By: Pandao | https://github.com/pandao/editor.md | 2016-05-01 */
!function(e){"use strict";if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module)module.exports=e;else if("function"==typeof define)if(define.amd){var t="codemirror/mode/",i="codemirror/addon/",r=["jquery","marked","prettify","katex","raphael","underscore","flowchart","jqueryflowchart","sequenceDiagram","codemirror/lib/codemirror",t+"css/css",t+"sass/sass",t+"shell/shell",t+"sql/sql",t+"clike/clike",t+"php/php",t+"xml/xml",t+"markdown/markdown",t+"javascript/javascript",t+"htmlmixed/htmlmixed",t+"gfm/gfm",t+"http/http",t+"go/go",t+"dart/dart",t+"coffeescript/coffeescript",t+"nginx/nginx",t+"python/python",t+"perl/perl",t+"lua/lua",t+"r/r",t+"ruby/ruby",t+"rst/rst",t+"smartymixed/smartymixed",t+"vb/vb",t+"vbscript/vbscript",t+"velocity/velocity",t+"xquery/xquery",t+"yaml/yaml",t+"erlang/erlang",t+"jade/jade",i+"edit/trailingspace",i+"dialog/dialog",i+"search/searchcursor",i+"search/search",i+"scroll/annotatescrollbar",i+"search/matchesonscrollbar",i+"display/placeholder",i+"edit/closetag",i+"fold/foldcode",i+"fold/foldgutter",i+"fold/indent-fold",i+"fold/brace-fold",i+"fold/xml-fold",i+"fold/markdown-fold",i+"fold/comment-fold",i+"mode/overlay",i+"selection/active-line",i+"edit/closebrackets",i+"display/fullscreen",i+"search/match-highlighter"];define(r,e)}else define(["jquery"],e);else window.editormd=e()}(function(){"function"==typeof define&&define.amd&&(e=arguments[0],marked=arguments[1],prettify=arguments[2],katex=arguments[3],Raphael=arguments[4],_=arguments[5],flowchart=arguments[6],CodeMirror=arguments[9]);var e="undefined"!=typeof jQuery?jQuery:Zepto;if("undefined"!=typeof e){var t=function(e,i){return new t.fn.init(e,i)};t.title=t.$name="Editor.md",t.version="1.5.0",t.homePage="https://pandao.github.io/editor.md/",t.classPrefix="editormd-",t.toolbarModes={full:["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"],simple:["undo","redo","|","bold","del","italic","quote","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","watch","preview","fullscreen","|","help","info"],mini:["undo","redo","|","watch","preview","|","help","info"]},t.defaults={mode:"gfm",name:"",value:"",theme:"",editorTheme:"default",previewTheme:"",markdown:"",appendMarkdown:"",width:"100%",height:"100%",path:"./lib/",pluginPath:"",delay:300,autoLoadModules:!0,watch:!0,placeholder:"Enjoy Markdown! coding now...",gotoLine:!0,codeFold:!1,autoHeight:!1,autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:"#fff",dialogMaskOpacity:.1,fontSize:"13px",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:"",crossDomainUpload:!1,uploadCallbackURL:"",toc:!0,tocm:!1,tocTitle:"",tocDropdown:!1,tocContainer:"",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:"full",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return t.toolbarHandlers.ucwords},lowercase:function(){return t.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:'<a href="javascript:;" title="Lowercase" unselectable="on"><i class="fa" name="lowercase" style="font-size:24px;margin-top: -10px;">a</i></a>',ucwords:'<a href="javascript:;" title="ucwords" unselectable="on"><i class="fa" name="ucwords" style="font-size:20px;margin-top: -3px;">Aa</i></a>'},toolbarIconsClass:{undo:"fa-undo",redo:"fa-repeat",bold:"fa-bold",del:"fa-strikethrough",italic:"fa-italic",quote:"fa-quote-left",uppercase:"fa-font",h1:t.classPrefix+"bold",h2:t.classPrefix+"bold",h3:t.classPrefix+"bold",h4:t.classPrefix+"bold",h5:t.classPrefix+"bold",h6:t.classPrefix+"bold","list-ul":"fa-list-ul","list-ol":"fa-list-ol",hr:"fa-minus",link:"fa-link","reference-link":"fa-anchor",image:"fa-picture-o",code:"fa-code","preformatted-text":"fa-file-code-o","code-block":"fa-file-code-o",table:"fa-table",datetime:"fa-clock-o",emoji:"fa-smile-o","html-entities":"fa-copyright",pagebreak:"fa-newspaper-o","goto-line":"fa-terminal",watch:"fa-eye-slash",unwatch:"fa-eye",preview:"fa-desktop",search:"fa-search",fullscreen:"fa-arrows-alt",clear:"fa-eraser",help:"fa-question-circle",info:"fa-info-circle"},toolbarIconTexts:{},lang:{name:"zh-cn",description:"开源在线Markdown编辑器<br/>Open source online Markdown editor.",tocTitle:"目录",toolbar:{undo:"撤销（Ctrl+Z）",redo:"重做（Ctrl+Y）",bold:"粗体",del:"删除线",italic:"斜体",quote:"引用",ucwords:"将每个单词首字母转成大写",uppercase:"将所选转换成大写",lowercase:"将所选转换成小写",h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6","list-ul":"无序列表","list-ol":"有序列表",hr:"横线",link:"链接","reference-link":"引用链接",image:"添加图片",code:"行内代码","preformatted-text":"预格式文本 / 代码块（缩进风格）","code-block":"代码块（多语言风格）",table:"添加表格",datetime:"日期时间",emoji:"Emoji表情","html-entities":"HTML实体字符",pagebreak:"插入分页符","goto-line":"跳转到行",watch:"关闭实时预览",unwatch:"开启实时预览",preview:"全窗口预览HTML（按 Shift + ESC还原）",fullscreen:"全屏（按ESC还原）",clear:"清空",search:"搜索",help:"使用帮助",info:"关于"+t.title},buttons:{enter:"确定",cancel:"取消",close:"关闭"},dialog:{link:{title:"添加链接",url:"链接地址",urlTitle:"链接标题",urlEmpty:"错误：请填写链接地址。"},referenceLink:{title:"添加引用链接",name:"引用名称",url:"链接地址",urlId:"链接ID",urlTitle:"链接标题",nameEmpty:"错误：引用链接的名称不能为空。",idEmpty:"错误：请填写引用链接的ID。",urlEmpty:"错误：请填写引用链接的URL地址。"},image:{title:"添加图片",url:"图片地址",link:"图片链接",alt:"图片描述",uploadButton:"本地上传",imageURLEmpty:"错误：图片地址不能为空。",uploadFileEmpty:"错误：上传的图片不能为空。",formatNotAllowed:"错误：只允许上传图片文件，允许上传的图片文件格式有："},preformattedText:{title:"添加预格式文本或代码块",emptyAlert:"错误：请填写预格式文本或代码的内容。"},codeBlock:{title:"添加代码块",selectLabel:"代码语言：",selectDefaultText:"请选择代码语言",otherLanguage:"其他语言",unselectedLanguageAlert:"错误：请选择代码所属的语言类型。",codeEmptyAlert:"错误：请填写代码内容。"},htmlEntities:{title:"HTML 实体字符"},help:{title:"使用帮助"}}}},t.classNames={tex:t.classPrefix+"tex"},t.dialogZindex=99999,t.$katex=null,t.$marked=null,t.$CodeMirror=null,t.$prettyPrint=null;var i,r;t.prototype=t.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(i,r){r=r||{},"object"==typeof i&&(r=i);var n=this.classPrefix=t.classPrefix,o=this.settings=e.extend(!0,t.defaults,r);i="object"==typeof i?o.id:i;var a=this.editor=e("#"+i);this.id=i,this.lang=o.lang;var s=this.classNames={textarea:{html:n+"html-textarea",markdown:n+"markdown-textarea"}};o.pluginPath=""===o.pluginPath?o.path+"../plugins/":o.pluginPath,this.state.watching=!!o.watch,a.hasClass("editormd")||a.addClass("editormd"),a.css({width:"number"==typeof o.width?o.width+"px":o.width,height:"number"==typeof o.height?o.height+"px":o.height}),o.autoHeight&&a.css("height","auto");var l=this.markdownTextarea=a.children("textarea");l.length<1&&(a.append("<textarea></textarea>"),l=this.markdownTextarea=a.children("textarea")),l.addClass(s.textarea.markdown).attr("placeholder",o.placeholder),"undefined"!=typeof l.attr("name")&&""!==l.attr("name")||l.attr("name",""!==o.name?o.name:i+"-markdown-doc");var c=[o.readOnly?"":'<a href="javascript:;" class="fa fa-close '+n+'preview-close-btn"></a>',o.saveHTMLToTextarea?'<textarea class="'+s.textarea.html+'" name="'+i+'-html-code"></textarea>':"",'<div class="'+n+'preview"><div class="markdown-body '+n+'preview-container"></div></div>','<div class="'+n+'container-mask" style="display:block;"></div>','<div class="'+n+'mask"></div>'].join("\n");return a.append(c).addClass(n+"vertical"),""!==o.theme&&a.addClass(n+"theme-"+o.theme),this.mask=a.children("."+n+"mask"),this.containerMask=a.children("."+n+"container-mask"),""!==o.markdown&&l.val(o.markdown),""!==o.appendMarkdown&&l.val(l.val()+o.appendMarkdown),this.htmlTextarea=a.children("."+s.textarea.html),this.preview=a.children("."+n+"preview"),this.previewContainer=this.preview.children("."+n+"preview-container"),""!==o.previewTheme&&this.preview.addClass(n+"preview-theme-"+o.previewTheme),"function"==typeof define&&define.amd&&("undefined"!=typeof katex&&(t.$katex=katex),o.searchReplace&&!o.readOnly&&(t.loadCSS(o.path+"codemirror/addon/dialog/dialog"),t.loadCSS(o.path+"codemirror/addon/search/matchesonscrollbar"))),"function"==typeof define&&define.amd||!o.autoLoadModules?("undefined"!=typeof CodeMirror&&(t.$CodeMirror=CodeMirror),"undefined"!=typeof marked&&(t.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var e=this,i=this.settings,r=i.path,n=function(){return t.isIE8?void e.loadedDisplay():void(i.flowChart||i.sequenceDiagram?t.loadScript(r+"raphael.min",function(){t.loadScript(r+"underscore.min",function(){!i.flowChart&&i.sequenceDiagram?t.loadScript(r+"sequence-diagram.min",function(){e.loadedDisplay()}):i.flowChart&&!i.sequenceDiagram?t.loadScript(r+"flowchart.min",function(){t.loadScript(r+"jquery.flowchart.min",function(){e.loadedDisplay()})}):i.flowChart&&i.sequenceDiagram&&t.loadScript(r+"flowchart.min",function(){t.loadScript(r+"jquery.flowchart.min",function(){t.loadScript(r+"sequence-diagram.min",function(){e.loadedDisplay()})})})})}):e.loadedDisplay())};return t.loadCSS(r+"codemirror/codemirror.min"),i.searchReplace&&!i.readOnly&&(t.loadCSS(r+"codemirror/addon/dialog/dialog"),t.loadCSS(r+"codemirror/addon/search/matchesonscrollbar")),i.codeFold&&t.loadCSS(r+"codemirror/addon/fold/foldgutter"),t.loadScript(r+"codemirror/codemirror.min",function(){t.$CodeMirror=CodeMirror,t.loadScript(r+"codemirror/modes.min",function(){t.loadScript(r+"codemirror/addons.min",function(){return e.setCodeMirror(),"gfm"!==i.mode&&"markdown"!==i.mode?(e.loadedDisplay(),!1):(e.setToolbar(),void t.loadScript(r+"marked.min",function(){t.$marked=marked,i.previewCodeHighlight?t.loadScript(r+"prettify.min",function(){n()}):n()}))})})}),this},setTheme:function(e){var t=this.editor,i=this.settings.theme,r=this.classPrefix+"theme-";return t.removeClass(r+i).addClass(r+e),this.settings.theme=e,this},setEditorTheme:function(e){var i=this.settings;return i.editorTheme=e,"default"!==e&&t.loadCSS(i.path+"codemirror/theme/"+i.editorTheme),this.cm.setOption("theme",e),this},setCodeMirrorTheme:function(e){return this.setEditorTheme(e),this},setPreviewTheme:function(e){var t=this.preview,i=this.settings.previewTheme,r=this.classPrefix+"preview-theme-";return t.removeClass(r+i).addClass(r+e),this.settings.previewTheme=e,this},setCodeMirror:function(){var e=this.settings,i=this.editor;"default"!==e.editorTheme&&t.loadCSS(e.path+"codemirror/theme/"+e.editorTheme);var r={mode:e.mode,theme:e.editorTheme,tabSize:e.tabSize,dragDrop:e.dragDrop,autofocus:e.autoFocus,autoCloseTags:e.autoCloseTags,readOnly:e.readOnly?"nocursor":!1,indentUnit:e.indentUnit,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,extraKeys:{"Ctrl-Q":function(e){e.foldCode(e.getCursor())}},foldGutter:e.codeFold,foldImg:e.foldImg,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:e.matchBrackets,indentWithTabs:e.indentWithTabs,styleActiveLine:e.styleActiveLine,styleSelectedText:e.styleSelectedText,autoCloseBrackets:e.autoCloseBrackets,showTrailingSpace:e.showTrailingSpace,highlightSelectionMatches:e.matchWordHighlight?{showToken:"onselected"===e.matchWordHighlight?!1:/\w/}:!1};return this.codeEditor=this.cm=t.$CodeMirror.fromTextArea(this.markdownTextarea[0],r),this.codeMirror=this.cmElement=i.children(".CodeMirror"),""!==e.value&&this.cm.setValue(e.value),this.codeMirror.css({fontSize:e.fontSize,width:e.watch?"50%":"100%"}),e.autoHeight&&(this.codeMirror.css("height","auto"),this.cm.setOption("viewportMargin",1/0)),e.lineNumbers||this.codeMirror.find(".CodeMirror-gutters").css("border-right","none"),this},getCodeMirrorOption:function(e){return this.cm.getOption(e)},setCodeMirrorOption:function(e,t){return this.cm.setOption(e,t),this},addKeyMap:function(e,t){return this.cm.addKeyMap(e,t),this},removeKeyMap:function(e){return this.cm.removeKeyMap(e),this},gotoLine:function(t){var i=this.settings;if(!i.gotoLine)return this;var r=this.cm,n=(this.editor,r.lineCount()),o=this.preview;if("string"==typeof t&&("last"===t&&(t=n),"first"===t&&(t=1)),"number"!=typeof t)return alert("Error: The line number must be an integer."),this;if(t=parseInt(t)-1,t>n)return alert("Error: The line number range 1-"+n),this;r.setCursor({line:t,ch:0});var a=r.getScrollInfo(),s=a.clientHeight,l=r.charCoords({line:t,ch:0},"local");if(r.scrollTo(null,(l.top+l.bottom-s)/2),i.watch){var c=this.codeMirror.find(".CodeMirror-scroll")[0],h=e(c).height(),u=c.scrollTop,d=u/c.scrollHeight;0===u?o.scrollTop(0):u+h>=c.scrollHeight-16?o.scrollTop(o[0].scrollHeight):o.scrollTop(o[0].scrollHeight*d)}return r.focus(),this},extend:function(){return"undefined"!=typeof arguments[1]&&("function"==typeof arguments[1]&&(arguments[1]=e.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),"object"==typeof arguments[0]&&"undefined"==typeof arguments[0].length&&e.extend(!0,this,arguments[0]),this},set:function(t,i){return"undefined"!=typeof i&&"function"==typeof i&&(i=e.proxy(i,this)),this[t]=i,this},config:function(t,i){var r=this.settings;return"object"==typeof t&&(r=e.extend(!0,r,t)),"string"==typeof t&&(r[t]=i),this.settings=r,this.recreate(),this},on:function(t,i){var r=this.settings;return"undefined"!=typeof r["on"+t]&&(r["on"+t]=e.proxy(i,this)),this},off:function(e){var t=this.settings;return"undefined"!=typeof t["on"+e]&&(t["on"+e]=function(){}),this},showToolbar:function(t){var i=this.settings;return i.readOnly?this:(i.toolbar&&(this.toolbar.length<1||""===this.toolbar.find("."+this.classPrefix+"menu").html())&&this.setToolbar(),i.toolbar=!0,this.toolbar.show(),this.resize(),e.proxy(t||function(){},this)(),this)},hideToolbar:function(t){var i=this.settings;return i.toolbar=!1,this.toolbar.hide(),this.resize(),e.proxy(t||function(){},this)(),this},setToolbarAutoFixed:function(t){var i=this.state,r=this.editor,n=this.toolbar,o=this.settings;"undefined"!=typeof t&&(o.toolbarAutoFixed=t);var a=function(){var t=e(window),i=t.scrollTop();return o.toolbarAutoFixed?void(i-r.offset().top>10&&i<r.height()?n.css({position:"fixed",width:r.width()+"px",left:(t.width()-r.width())/2+"px"}):n.css({position:"absolute",width:"100%",left:0})):!1};return!i.fullscreen&&!i.preview&&o.toolbar&&o.toolbarAutoFixed&&e(window).bind("scroll",a),this},setToolbar:function(){var e=this.settings;if(e.readOnly)return this;var i=this.editor,r=(this.preview,this.classPrefix),n=this.toolbar=i.children("."+r+"toolbar");if(e.toolbar&&n.length<1){var o='<div class="'+r+'toolbar"><div class="'+r+'toolbar-container"><ul class="'+r+'menu"></ul></div></div>';i.append(o),n=this.toolbar=i.children("."+r+"toolbar")}if(!e.toolbar)return n.hide(),this;n.show();for(var a="function"==typeof e.toolbarIcons?e.toolbarIcons():"string"==typeof e.toolbarIcons?t.toolbarModes[e.toolbarIcons]:e.toolbarIcons,s=n.find("."+this.classPrefix+"menu"),l="",c=!1,h=0,u=a.length;u>h;h++){var d=a[h];if("||"===d)c=!0;else if("|"===d)l+='<li class="divider" unselectable="on">|</li>';else{var f=/h(\d)/.test(d),p=d;"watch"!==d||e.watch||(p="unwatch");var g=e.lang.toolbar[p],m=e.toolbarIconTexts[p],v=e.toolbarIconsClass[p];g="undefined"==typeof g?"":g,m="undefined"==typeof m?"":m,v="undefined"==typeof v?"":v;var w=c?'<li class="pull-right">':"<li>";"undefined"!=typeof e.toolbarCustomIcons[d]&&"function"!=typeof e.toolbarCustomIcons[d]?w+=e.toolbarCustomIcons[d]:(w+='<a href="javascript:;" title="'+g+'" unselectable="on">',w+='<i class="fa '+v+'" name="'+d+'" unselectable="on">'+(f?d.toUpperCase():""===v?m:"")+"</i>",w+="</a>"),w+="</li>",l=c?w+l:l+w}}return s.html(l),s.find('[title="Lowercase"]').attr("title",e.lang.toolbar.lowercase),s.find('[title="ucwords"]').attr("title",e.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return e.proxy(t.dialogLockScreen,this)(),this},dialogShowMask:function(i){return e.proxy(t.dialogShowMask,this)(i),this},getToolbarHandles:function(e){var i=this.toolbarHandlers=t.toolbarHandlers;return e&&"undefined"!=typeof toolbarIconHandlers[e]?i[e]:i},setToolbarHandler:function(){var i=this,r=this.settings;if(!r.toolbar||r.readOnly)return this;var n=this.toolbar,o=this.cm,a=this.classPrefix,s=this.toolbarIcons=n.find("."+a+"menu > li > a"),l=this.getToolbarHandles();return s.bind(t.mouseOrTouch("click","touchend"),function(t){var n=e(this).children(".fa"),a=n.attr("name"),s=o.getCursor(),c=o.getSelection();return""!==a?(i.activeIcon=n,"undefined"!=typeof l[a]?e.proxy(l[a],i)(o):"undefined"!=typeof r.toolbarHandlers[a]&&e.proxy(r.toolbarHandlers[a],i)(o,n,s,c),"link"!==a&&"reference-link"!==a&&"image"!==a&&"code-block"!==a&&"preformatted-text"!==a&&"watch"!==a&&"preview"!==a&&"search"!==a&&"fullscreen"!==a&&"info"!==a&&o.focus(),!1):void 0}),this},createDialog:function(i){return e.proxy(t.createDialog,this)(i)},createInfoDialog:function(){var e=this,i=this.editor,r=this.classPrefix,n=['<div class="'+r+"dialog "+r+'dialog-info" style="">','<div class="'+r+'dialog-container">','<h1><i class="editormd-logo editormd-logo-lg editormd-logo-color"></i> '+t.title+"<small>v"+t.version+"</small></h1>","<p>"+this.lang.description+"</p>",'<p style="margin: 10px 0 20px 0;"><a href="'+t.homePage+'" target="_blank">'+t.homePage+' <i class="fa fa-external-link"></i></a></p>','<p style="font-size: 0.85em;">Copyright &copy; 2015 <a href="https://github.com/pandao" target="_blank" class="hover-link">Pandao</a>, The <a href="https://github.com/pandao/editor.md/blob/master/LICENSE" target="_blank" class="hover-link">MIT</a> License.</p>',"</div>",'<a href="javascript:;" class="fa fa-close '+r+'dialog-close"></a>',"</div>"].join("\n");i.append(n);var o=this.infoDialog=i.children("."+r+"dialog-info");return o.find("."+r+"dialog-close").bind(t.mouseOrTouch("click","touchend"),function(){e.hideInfoDialog()}),o.css("border",t.isIE8?"1px solid #ddd":"").css("z-index",t.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var t=this.infoDialog,i=function(){t.css({top:(e(window).height()-t.height())/2+"px",left:(e(window).width()-t.width())/2+"px"})};return i(),e(window).resize(i),this},showInfoDialog:function(){e("html,body").css("overflow-x","hidden");var i=this.editor,r=this.settings,n=this.infoDialog=i.children("."+this.classPrefix+"dialog-info");return n.length<1&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:r.dialogMaskOpacity,backgroundColor:r.dialogMaskBgColor}).show(),n.css("z-index",t.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return e("html,body").css("overflow-x",""),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(e){return t.lockScreen(e),this.resize(),this},recreate:function(){var e=this.editor,t=this.settings;return this.codeMirror.remove(),this.setCodeMirror(),t.readOnly||(e.find(".editormd-dialog").length>0&&e.find(".editormd-dialog").remove(),t.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),this},previewCodeHighlight:function(){var e=this.settings,t=this.previewContainer;return e.previewCodeHighlight&&(t.find("pre").addClass("prettyprint linenums"),"undefined"!=typeof prettyPrint&&prettyPrint()),this},katexRender:function(){return null===i?this:(this.previewContainer.find("."+t.classNames.tex).each(function(){var i=e(this);t.$katex.render(i.text(),i[0]),i.find(".katex").css("font-size","1.6em")}),this)},flowChartAndSequenceDiagramRender:function(){var i=this,n=this.settings,o=this.previewContainer;if(t.isIE8)return this;if(n.flowChart){if(null===r)return this;o.find(".flowchart").flowChart()}n.sequenceDiagram&&o.find(".sequence-diagram").sequenceDiagram({theme:"simple"});var a=i.preview,s=i.codeMirror,l=s.find(".CodeMirror-scroll"),c=l.height(),h=l.scrollTop(),u=h/l[0].scrollHeight,d=0;a.find(".markdown-toc-list").each(function(){d+=e(this).height()});var f=a.find(".editormd-toc-menu").height();return f=f?f:0,0===h?a.scrollTop(0):h+c>=l[0].scrollHeight-16?a.scrollTop(a[0].scrollHeight):a.scrollTop((a[0].scrollHeight+d+f)*u),this},registerKeyMaps:function(i){var r=this,n=this.cm,o=this.settings,a=t.toolbarHandlers,s=o.disabledKeyMaps;if(i=i||null){for(var l in i)if(e.inArray(l,s)<0){var c={};c[l]=i[l],n.addKeyMap(i)}}else{for(var h in t.keyMaps){var u=t.keyMaps[h],d="string"==typeof u?e.proxy(a[u],r):e.proxy(u,r);if(e.inArray(h,["F9","F10","F11"])<0&&e.inArray(h,s)<0){var f={};f[h]=d,n.addKeyMap(f)}}e(window).keydown(function(t){var i={120:"F9",121:"F10",122:"F11"};if(e.inArray(i[t.keyCode],s)<0)switch(t.keyCode){case 120:return e.proxy(a.watch,r)(),!1;case 121:return e.proxy(a.preview,r)(),!1;case 122:return e.proxy(a.fullscreen,r)(),!1}})}return this},bindScrollEvent:function(){var i=this,r=this.preview,n=this.settings,o=this.codeMirror,a=t.mouseOrTouch;if(!n.syncScrolling)return this;var s=function(){o.find(".CodeMirror-scroll").bind(a("scroll","touchmove"),function(t){var o=e(this).height(),a=e(this).scrollTop(),s=a/e(this)[0].scrollHeight,l=0;r.find(".markdown-toc-list").each(function(){l+=e(this).height()});var c=r.find(".editormd-toc-menu").height();c=c?c:0,0===a?r.scrollTop(0):a+o>=e(this)[0].scrollHeight-16?r.scrollTop(r[0].scrollHeight):r.scrollTop((r[0].scrollHeight+l+c)*s),e.proxy(n.onscroll,i)(t)})},l=function(){o.find(".CodeMirror-scroll").unbind(a("scroll","touchmove"))},c=function(){r.bind(a("scroll","touchmove"),function(t){var r=e(this).height(),a=e(this).scrollTop(),s=a/e(this)[0].scrollHeight,l=o.find(".CodeMirror-scroll");0===a?l.scrollTop(0):a+r>=e(this)[0].scrollHeight?l.scrollTop(l[0].scrollHeight):l.scrollTop(l[0].scrollHeight*s),e.proxy(n.onpreviewscroll,i)(t)})},h=function(){r.unbind(a("scroll","touchmove"))};return o.bind({mouseover:s,mouseout:l,touchstart:s,touchend:l}),"single"===n.syncScrolling?this:(r.bind({mouseover:c,mouseout:h,touchstart:c,touchend:h}),this)},bindChangeEvent:function(){var e=this,t=this.cm,r=this.settings;return r.syncScrolling?(t.on("change",function(t,n){r.watch&&e.previewContainer.css("padding",r.autoHeight?"20px 20px 50px 40px":"20px"),i=setTimeout(function(){clearTimeout(i),e.save(),i=null},r.delay)}),this):this},loadedDisplay:function(t){t=t||!1;var i=this,r=this.editor,n=this.preview,o=this.settings;return this.containerMask.hide(),this.save(),o.watch&&n.show(),r.data("oldWidth",r.width()).data("oldHeight",r.height()),this.resize(),this.registerKeyMaps(),e(window).resize(function(){i.resize()}),this.bindScrollEvent().bindChangeEvent(),t||e.proxy(o.onload,this)(),this.state.loaded=!0,this},width:function(e){return this.editor.css("width","number"==typeof e?e+"px":e),this.resize(),this},height:function(e){return this.editor.css("height","number"==typeof e?e+"px":e),this.resize(),this},resize:function(t,i){t=t||null,i=i||null;var r=this.state,n=this.editor,o=this.preview,a=this.toolbar,s=this.settings,l=this.codeMirror;if(t&&n.css("width","number"==typeof t?t+"px":t),!s.autoHeight||r.fullscreen||r.preview?(i&&n.css("height","number"==typeof i?i+"px":i),r.fullscreen&&n.height(e(window).height()),s.toolbar&&!s.readOnly?l.css("margin-top",a.height()+1).height(n.height()-a.height()):l.css("margin-top",0).height(n.height())):(n.css("height","auto"),l.css("height","auto")),s.watch)if(l.width(n.width()/2),o.width(r.preview?n.width():n.width()/2),this.previewContainer.css("padding",s.autoHeight?"20px 20px 50px 40px":"20px"),s.toolbar&&!s.readOnly?o.css("top",a.height()+1):o.css("top",0),!s.autoHeight||r.fullscreen||r.preview){var c=s.toolbar&&!s.readOnly?n.height()-a.height():n.height();o.height(c)}else o.height("");else l.width(n.width()),o.hide();return r.loaded&&e.proxy(s.onresize,this)(),this},save:function(){if(null===i)return this;var n=this,o=this.state,a=this.settings,s=this.cm,l=s.getValue(),c=this.previewContainer;if("gfm"!==a.mode&&"markdown"!==a.mode)return this.markdownTextarea.val(l),this;var h=t.$marked,u=this.markdownToC=[],d=this.markedRendererOptions={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,pageBreak:a.pageBreak,taskList:a.taskList,emoji:a.emoji,tex:a.tex,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},f=this.markedOptions={renderer:t.markedRenderer(u,d),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!a.htmlDecode,smartLists:!0,smartypants:!0};h.setOptions(f);var p=t.$marked(l,f);if(p=t.filterHTMLTags(p,a.htmlDecode),this.markdownTextarea.text(l),s.save(),a.saveHTMLToTextarea&&this.htmlTextarea.text(p),a.watch||!a.watch&&o.preview){if(c.html(p),this.previewCodeHighlight(),a.toc){var g=""===a.tocContainer?c:e(a.tocContainer),m=g.find("."+this.classPrefix+"toc-menu");g.attr("previewContainer",""===a.tocContainer?"true":"false"),""!==a.tocContainer&&m.length>0&&m.remove(),t.markdownToCRenderer(u,g,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||g.find("."+this.classPrefix+"toc-menu").length>0)&&t.tocDropdownMenu(g,""!==a.tocTitle?a.tocTitle:this.lang.tocTitle),""!==a.tocContainer&&c.find(".markdown-toc").css("border","none")}a.tex&&(!t.kaTeXLoaded&&a.autoLoadModules?t.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,n.katexRender()}):(t.$katex=katex,this.katexRender())),(a.flowChart||a.sequenceDiagram)&&(r=setTimeout(function(){clearTimeout(r),n.flowChartAndSequenceDiagramRender(),r=null},10)),o.loaded&&e.proxy(a.onchange,this)()}return this},focus:function(){return this.cm.focus(),this},setCursor:function(e){return this.cm.setCursor(e),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(e,t){return this.cm.setSelection(e,t),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(e){return this.cm.setSelections(e),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(e){return this.cm.replaceSelection(e),this},insertValue:function(e){return this.replaceSelection(e),this},appendMarkdown:function(e){var t=(this.settings,this.cm);return t.setValue(t.getValue()+e),this},setMarkdown:function(e){return this.cm.setValue(e||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(e){return this.cm.setValue(e),this},clear:function(){return this.cm.setValue(""),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert("Error: settings.saveHTMLToTextarea == false"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert("Error: settings.watch == false"),!1)},watch:function(t){var r=this.settings;if(e.inArray(r.mode,["gfm","markdown"])<0)return this;if(this.state.watching=r.watch=!0,this.preview.show(),this.toolbar){var n=r.toolbarIconsClass.watch,o=r.toolbarIconsClass.unwatch,a=this.toolbar.find(".fa[name=watch]");a.parent().attr("title",r.lang.toolbar.watch),a.removeClass(o).addClass(n)}return this.codeMirror.css("border-right","1px solid #ddd").width(this.editor.width()/2),i=0,this.save().resize(),r.onwatch||(r.onwatch=t||function(){}),e.proxy(r.onwatch,this)(),this},unwatch:function(t){var i=this.settings;if(this.state.watching=i.watch=!1,this.preview.hide(),this.toolbar){var r=i.toolbarIconsClass.watch,n=i.toolbarIconsClass.unwatch,o=this.toolbar.find(".fa[name=watch]");o.parent().attr("title",i.lang.toolbar.unwatch),o.removeClass(r).addClass(n)}return this.codeMirror.css("border-right","none").width(this.editor.width()),this.resize(),i.onunwatch||(i.onunwatch=t||function(){}),e.proxy(i.onunwatch,this)(),this},show:function(t){t=t||function(){};var i=this;return this.editor.show(0,function(){e.proxy(t,i)()}),this},hide:function(t){t=t||function(){};var i=this;return this.editor.hide(0,function(){e.proxy(t,i)()}),this},previewing:function(){var i=this,r=this.editor,n=this.preview,o=this.toolbar,a=this.settings,s=this.codeMirror,l=this.previewContainer;if(e.inArray(a.mode,["gfm","markdown"])<0)return this;a.toolbar&&o&&(o.toggle(),o.find(".fa[name=preview]").toggleClass("active")),s.toggle();var c=function(e){e.shiftKey&&27===e.keyCode&&i.previewed()};"none"===s.css("display")?(this.state.preview=!0,this.state.fullscreen&&n.css("background","#fff"),r.find("."+this.classPrefix+"preview-close-btn").show().bind(t.mouseOrTouch("click","touchend"),function(){i.previewed()}),a.watch?l.css("padding",""):this.save(),l.addClass(this.classPrefix+"preview-active"),n.show().css({position:"",top:0,width:r.width(),height:a.autoHeight&&!this.state.fullscreen?"auto":r.height()}),this.state.loaded&&e.proxy(a.onpreviewing,this)(),e(window).bind("keyup",c)):(e(window).unbind("keyup",c),this.previewed())},previewed:function(){var i=this.editor,r=this.preview,n=this.toolbar,o=this.settings,a=this.previewContainer,s=i.find("."+this.classPrefix+"preview-close-btn");return this.state.preview=!1,this.codeMirror.show(),o.toolbar&&n.show(),r[o.watch?"show":"hide"](),s.hide().unbind(t.mouseOrTouch("click","touchend")),a.removeClass(this.classPrefix+"preview-active"),o.watch&&a.css("padding","20px"),r.css({background:null,position:"absolute",width:i.width()/2,height:o.autoHeight&&!this.state.fullscreen?"auto":i.height()-n.height(),top:o.toolbar?n.height():0}),this.state.loaded&&e.proxy(o.onpreviewed,this)(),this},fullscreen:function(){var t=this,i=this.state,r=this.editor,n=(this.preview,this.toolbar),o=this.settings,a=this.classPrefix+"fullscreen";n&&n.find(".fa[name=fullscreen]").parent().toggleClass("active");var s=function(e){e.shiftKey||27!==e.keyCode||i.fullscreen&&t.fullscreenExit()};return r.hasClass(a)?(e(window).unbind("keyup",s),this.fullscreenExit()):(i.fullscreen=!0,e("html,body").css("overflow","hidden"),r.css({width:e(window).width(),height:e(window).height()}).addClass(a),this.resize(),e.proxy(o.onfullscreen,this)(),e(window).bind("keyup",s)),this},fullscreenExit:function(){var t=this.editor,i=this.settings,r=this.toolbar,n=this.classPrefix+"fullscreen";return this.state.fullscreen=!1,r&&r.find(".fa[name=fullscreen]").parent().removeClass("active"),e("html,body").css("overflow",""),t.css({width:t.data("oldWidth"),height:t.data("oldHeight")}).removeClass(n),this.resize(),e.proxy(i.onfullscreenExit,this)(),this},executePlugin:function(i,r){var n=this,o=this.cm,a=this.settings;return r=a.pluginPath+r,"function"==typeof define?"undefined"==typeof this[i]?(alert("Error: "+i+" plugin is not found, you are not load this plugin."),this):(this[i](o),this):(e.inArray(r,t.loadFiles.plugin)<0?t.loadPlugin(r,function(){t.loadPlugins[i]=n[i],n[i](o)}):e.proxy(t.loadPlugins[i],this)(o),this)},search:function(e){var t=this.settings;return t.searchReplace?(t.readOnly||this.cm.execCommand(e||"find"),this):(alert("Error: settings.searchReplace == false"),this)},searchReplace:function(){return this.search("replace"),this},searchReplaceAll:function(){return this.search("replaceAll"),this}},t.fn.init.prototype=t.fn,t.dialogLockScreen=function(){var t=this.settings||{dialogLockScreen:!0};t.dialogLockScreen&&(e("html,body").css("overflow","hidden"),this.resize())},t.dialogShowMask=function(t){var i=this.editor,r=this.settings||{dialogShowMask:!0};t.css({top:(e(window).height()-t.height())/2+"px",left:(e(window).width()-t.width())/2+"px"}),r.dialogShowMask&&i.children("."+this.classPrefix+"mask").css("z-index",parseInt(t.css("z-index"))-1).show();
},t.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection("**"+i+"**"),""===i&&e.setCursor(t.line,t.ch+2)},del:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection("~~"+i+"~~"),""===i&&e.setCursor(t.line,t.ch+2)},italic:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection("*"+i+"*"),""===i&&e.setCursor(t.line,t.ch+1)},quote:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("> "+i),e.setCursor(t.line,t.ch+2)):e.replaceSelection("> "+i)},ucfirst:function(){var e=this.cm,i=e.getSelection(),r=e.listSelections();e.replaceSelection(t.firstUpperCase(i)),e.setSelections(r)},ucwords:function(){var e=this.cm,i=e.getSelection(),r=e.listSelections();e.replaceSelection(t.wordsFirstUpperCase(i)),e.setSelections(r)},uppercase:function(){var e=this.cm,t=e.getSelection(),i=e.listSelections();e.replaceSelection(t.toUpperCase()),e.setSelections(i)},lowercase:function(){var e=this.cm,t=(e.getCursor(),e.getSelection()),i=e.listSelections();e.replaceSelection(t.toLowerCase()),e.setSelections(i)},h1:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("# "+i),e.setCursor(t.line,t.ch+2)):e.replaceSelection("# "+i)},h2:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("## "+i),e.setCursor(t.line,t.ch+3)):e.replaceSelection("## "+i)},h3:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("### "+i),e.setCursor(t.line,t.ch+4)):e.replaceSelection("### "+i)},h4:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("#### "+i),e.setCursor(t.line,t.ch+5)):e.replaceSelection("#### "+i)},h5:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("##### "+i),e.setCursor(t.line,t.ch+6)):e.replaceSelection("##### "+i)},h6:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("###### "+i),e.setCursor(t.line,t.ch+7)):e.replaceSelection("###### "+i)},"list-ul":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(""===t)e.replaceSelection("- "+t);else{for(var i=t.split("\n"),r=0,n=i.length;n>r;r++)i[r]=""===i[r]?"":"- "+i[r];e.replaceSelection(i.join("\n"))}},"list-ol":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(""===t)e.replaceSelection("1. "+t);else{for(var i=t.split("\n"),r=0,n=i.length;n>r;r++)i[r]=""===i[r]?"":r+1+". "+i[r];e.replaceSelection(i.join("\n"))}},hr:function(){var e=this.cm,t=e.getCursor();e.getSelection();e.replaceSelection((0!==t.ch?"\n\n":"\n")+"------------\n\n")},tex:function(){if(!this.settings.tex)return alert("settings.tex === false"),this;var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection("$$"+i+"$$"),""===i&&e.setCursor(t.line,t.ch+2)},link:function(){this.executePlugin("linkDialog","link-dialog/link-dialog")},"reference-link":function(){this.executePlugin("referenceLinkDialog","reference-link-dialog/reference-link-dialog")},pagebreak:function(){if(!this.settings.pageBreak)return alert("settings.pageBreak === false"),this;var e=this.cm;e.getSelection();e.replaceSelection("\r\n[========]\r\n")},image:function(){this.executePlugin("imageDialog","image-dialog/image-dialog")},code:function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection("`"+i+"`"),""===i&&e.setCursor(t.line,t.ch+1)},"code-block":function(){this.executePlugin("codeBlockDialog","code-block-dialog/code-block-dialog")},"preformatted-text":function(){this.executePlugin("preformattedTextDialog","preformatted-text-dialog/preformatted-text-dialog")},table:function(){this.executePlugin("tableDialog","table-dialog/table-dialog")},datetime:function(){var e=this.cm,i=(e.getSelection(),new Date,this.settings.lang.name),r=t.dateFormat()+" "+t.dateFormat("zh-cn"===i||"zh-tw"===i?"cn-week-day":"week-day");e.replaceSelection(r)},emoji:function(){this.executePlugin("emojiDialog","emoji-dialog/emoji-dialog")},"html-entities":function(){this.executePlugin("htmlEntitiesDialog","html-entities-dialog/html-entities-dialog")},"goto-line":function(){this.executePlugin("gotoLineDialog","goto-line-dialog/goto-line-dialog")},watch:function(){this[this.settings.watch?"unwatch":"watch"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin("helpDialog","help-dialog/help-dialog")},info:function(){this.showInfoDialog()}},t.keyMaps={"Ctrl-1":"h1","Ctrl-2":"h2","Ctrl-3":"h3","Ctrl-4":"h4","Ctrl-5":"h5","Ctrl-6":"h6","Ctrl-B":"bold","Ctrl-D":"datetime","Ctrl-E":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();return this.settings.emoji?(e.replaceSelection(":"+i+":"),void(""===i&&e.setCursor(t.line,t.ch+1))):void alert("Error: settings.emoji == false")},"Ctrl-Alt-G":"goto-line","Ctrl-H":"hr","Ctrl-I":"italic","Ctrl-K":"code","Ctrl-L":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection(),r=""===i?"":' "'+i+'"';e.replaceSelection("["+i+"]("+r+")"),""===i&&e.setCursor(t.line,t.ch+1)},"Ctrl-U":"list-ul","Shift-Ctrl-A":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();return this.settings.atLink?(e.replaceSelection("@"+i),void(""===i&&e.setCursor(t.line,t.ch+1))):void alert("Error: settings.atLink == false")},"Shift-Ctrl-C":"code","Shift-Ctrl-Q":"quote","Shift-Ctrl-S":"del","Shift-Ctrl-K":"tex","Shift-Alt-C":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection();e.replaceSelection(["```",i,"```"].join("\n")),""===i&&e.setCursor(t.line,t.ch+3)},"Shift-Ctrl-Alt-C":"code-block","Shift-Ctrl-H":"html-entities","Shift-Alt-H":"help","Shift-Ctrl-E":"emoji","Shift-Ctrl-U":"uppercase","Shift-Alt-U":"ucwords","Shift-Ctrl-Alt-U":"ucfirst","Shift-Alt-L":"lowercase","Shift-Ctrl-I":function(){var e=this.cm,t=e.getCursor(),i=e.getSelection(),r=""===i?"":' "'+i+'"';e.replaceSelection("!["+i+"]("+r+")"),""===i&&e.setCursor(t.line,t.ch+4)},"Shift-Ctrl-Alt-I":"image","Shift-Ctrl-L":"link","Shift-Ctrl-O":"list-ol","Shift-Ctrl-P":"preformatted-text","Shift-Ctrl-T":"table","Shift-Alt-P":"pagebreak",F9:"watch",F10:"preview",F11:"fullscreen"};var n=function(e){return String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};t.trim=n;var o=function(e){return e.toLowerCase().replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()})};t.ucwords=t.wordsFirstUpperCase=o;var a=function(e){return e.toLowerCase().replace(/\b(\w)/,function(e){return e.toUpperCase()})};return t.firstUpperCase=t.ucfirst=a,t.urls={atLinkBase:"https://github.com/"},t.regexs={atLink:/@(\w+)/g,email:/(\w+)@(\w+)\.(\w+)\.?(\w+)?/g,emailLink:/(mailto:)?([\w\.\_]+)@(\w+)\.(\w+)\.?(\w+)?/g,emoji:/:([\w\+-]+):/g,emojiDatetime:/(\d{2}:\d{2}:\d{2})/g,twemoji:/:(tw-([\w]+)-?(\w+)?):/g,fontAwesome:/:(fa-([\w]+)(-(\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\w+)?):/g,pageBreak:/^\[[=]{8,}\]$/},t.emoji={path:"http://www.emoji-cheat-sheet.com/graphics/emojis/",ext:".png"},t.twemoji={path:"http://twemoji.maxcdn.com/36x36/",ext:".png"},t.markedRenderer=function(i,r){var o={toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},a=e.extend(o,r||{}),s=t.$marked,l=new s.Renderer;i=i||[];var c=t.regexs,h=c.atLink,u=c.emoji,d=c.email,f=c.emailLink,p=c.twemoji,g=c.fontAwesome,m=c.editormdLogo,v=c.pageBreak;return l.emoji=function(e){e=e.replace(t.regexs.emojiDatetime,function(e){return e.replace(/:/g,"&#58;")});var i=e.match(u);if(!i||!a.emoji)return e;for(var r=0,n=i.length;n>r;r++)":+1:"===i[r]&&(i[r]=":\\+1:"),e=e.replace(new RegExp(i[r]),function(e,i){var r=e.match(g),n=e.replace(/:/g,"");if(r)for(var o=0,a=r.length;a>o;o++){var s=r[o].replace(/:/g,"");return'<i class="fa '+s+' fa-emoji" title="'+s.replace("fa-","")+'"></i>'}else{var l=e.match(m),c=e.match(p);if(l)for(var h=0,u=l.length;u>h;h++){var d=l[h].replace(/:/g,"");return'<i class="'+d+'" title="Editor.md logo ('+d+')"></i>'}else{if(!c){var f="+1"===n?"plus1":n;return f="black_large_square"===f?"black_square":f,f="moon"===f?"waxing_gibbous_moon":f,'<img src="'+t.emoji.path+f+t.emoji.ext+'" class="emoji" title="&#58;'+n+'&#58;" alt="&#58;'+n+'&#58;" />'}for(var v=0,w=c.length;w>v;v++){var y=c[v].replace(/:/g,"").replace("tw-","");return'<img src="'+t.twemoji.path+y+t.twemoji.ext+'" title="twemoji-'+y+'" alt="twemoji-'+y+'" class="emoji twemoji" />'}}}});return e},l.atLink=function(i){return h.test(i)?(a.atLink&&(i=i.replace(d,function(e,t,i,r){return e.replace(/@/g,"_#_&#64;_#_")}),i=i.replace(h,function(e,i){return'<a href="'+t.urls.atLinkBase+i+'" title="&#64;'+i+'" class="at-link">'+e+"</a>"}).replace(/_#_&#64;_#_/g,"@")),a.emailLink&&(i=i.replace(f,function(t,i,r,n,o){return!i&&e.inArray(o,"jpg|jpeg|png|gif|webp|ico|icon|pdf".split("|"))<0?'<a href="mailto:'+t+'">'+t+"</a>":t})),i):i},l.link=function(e,t,i){if(this.options.sanitize){try{var r=decodeURIComponent(unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(n){return""}if(0===r.indexOf("javascript:"))return""}var o='<a href="'+e+'"';return h.test(t)||h.test(i)?(t&&(o+=' title="'+t.replace(/@/g,"&#64;")),o+'">'+i.replace(/@/g,"&#64;")+"</a>"):(t&&(o+=' title="'+t+'"'),o+=">"+i+"</a>")},l.heading=function(e,t,r){var o=e,a=/\s*\<a\s*href\=\"(.*)\"\s*([^\>]*)\>(.*)\<\/a\>\s*/;if(a.test(e)){var s=[];e=e.split(/\<a\s*([^\>]+)\>([^\>]*)\<\/a\>/);for(var l=0,c=e.length;c>l;l++)s.push(e[l].replace(/\s*href\=\"(.*)\"\s*/g,""));e=s.join(" ")}e=n(e);var h=e.toLowerCase().replace(/[^\w]+/g,"-"),u={text:e,level:t,slug:h},d=/^[\u4e00-\u9fa5]+$/.test(e),f=d?escape(e).replace(/\%/g,""):e.toLowerCase().replace(/[^\w]+/g,"-");i.push(u);var p="<h"+t+' id="h'+t+"-"+this.options.headerPrefix+f+'">';return p+='<a name="'+e+'" class="reference-link"></a>',p+='<span class="header-link octicon octicon-link"></span>',p+=a?this.atLink(this.emoji(o)):this.atLink(this.emoji(e)),p+="</h"+t+">"},l.pageBreak=function(e){return v.test(e)&&a.pageBreak&&(e='<hr style="page-break-after:always;" class="page-break editormd-page-break" />'),e},l.paragraph=function(e){var i=/\$\$(.*)\$\$/g.test(e),r=/^\$\$(.*)\$\$$/.test(e),n=r?' class="'+t.classNames.tex+'"':"",o=a.tocm?/^(\[TOC\]|\[TOCM\])$/.test(e):/^\[TOC\]$/.test(e),s=/^\[TOCM\]$/.test(e);e=!r&&i?e.replace(/(\$\$([^\$]*)\$\$)+/g,function(e,i){return'<span class="'+t.classNames.tex+'">'+i.replace(/\$/g,"")+"</span>"}):r?e.replace(/\$/g,""):e;var l='<div class="markdown-toc editormd-markdown-toc">'+e+"</div>";return o?s?'<div class="editormd-toc-menu">'+l+"</div><br/>":l:v.test(e)?this.pageBreak(e):"<p"+n+">"+this.atLink(this.emoji(e))+"</p>\n"},l.code=function(e,i,r){return"seq"===i||"sequence"===i?'<div class="sequence-diagram">'+e+"</div>":"flow"===i?'<div class="flowchart">'+e+"</div>":"math"===i||"latex"===i||"katex"===i?'<p class="'+t.classNames.tex+'">'+e+"</p>":s.Renderer.prototype.code.apply(this,arguments)},l.tablecell=function(e,t){var i=t.header?"th":"td",r=t.align?"<"+i+' style="text-align:'+t.align+'">':"<"+i+">";return r+this.atLink(this.emoji(e))+"</"+i+">\n"},l.listitem=function(e){return a.taskList&&/^\s*\[[x\s]\]\s*/.test(e)?(e=e.replace(/^\s*\[\s\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" /> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" checked disabled /> '),'<li style="list-style: none;">'+this.atLink(this.emoji(e))+"</li>"):"<li>"+this.atLink(this.emoji(e))+"</li>"},l},t.markdownToCRenderer=function(e,t,i,r){var n="",o=0,a=this.classPrefix;r=r||1;for(var s=0,l=e.length;l>s;s++){var c=e[s].text,h=e[s].level;r>h||(n+=h>o?"":o>h?new Array(o-h+2).join("</ul></li>"):"</ul></li>",n+='<li><a class="toc-level-'+h+'" href="#'+c+'" level="'+h+'">'+c+"</a><ul>",o=h)}var u=t.find(".markdown-toc");if(u.length<1&&"false"===t.attr("previewContainer")){var d='<div class="markdown-toc '+a+'markdown-toc"></div>';d=i?'<div class="'+a+'toc-menu">'+d+"</div>":d,t.html(d),u=t.find(".markdown-toc")}return i&&u.wrap('<div class="'+a+'toc-menu"></div><br/>'),u.html('<ul class="markdown-toc-list"></ul>').children(".markdown-toc-list").html(n.replace(/\r?\n?\<ul\>\<\/ul\>/g,"")),u},t.tocDropdownMenu=function(t,i){i=i||"Table of Contents";var r=400,n=t.find("."+this.classPrefix+"toc-menu");return n.each(function(){var t=e(this),n=t.children(".markdown-toc"),o='<i class="fa fa-angle-down"></i>',a='<a href="javascript:;" class="toc-menu-btn">'+o+i+"</a>",s=n.children("ul"),l=s.find("li");n.append(a),l.first().before("<li><h1>"+i+" "+o+"</h1></li>"),t.mouseover(function(){s.show(),l.each(function(){var t=e(this),i=t.children("ul");if(""===i.html()&&i.remove(),i.length>0&&""!==i.html()){var n=t.children("a").first();n.children(".fa").length<1&&n.append(e(o).css({"float":"right",paddingTop:"4px"}))}t.mouseover(function(){i.css("z-index",r).show(),r+=1}).mouseleave(function(){i.hide()})})}).mouseleave(function(){s.hide()})}),n},t.filterHTMLTags=function(t,i){if("string"!=typeof t&&(t=new String(t)),"string"!=typeof i)return t;for(var r=i.split("|"),n=r[0].split(","),o=r[1],a=0,s=n.length;s>a;a++){var l=n[a];t=t.replace(new RegExp("<s*"+l+"s*([^>]*)>([^>]*)<s*/"+l+"s*>","igm"),"")}if("undefined"!=typeof o){var c=/\<(\w+)\s*([^\>]*)\>([^\>]*)\<\/(\w+)\>/gi;t="*"===o?t.replace(c,function(e,t,i,r,n){return"<"+t+">"+r+"</"+n+">"}):"on*"===o?t.replace(c,function(t,i,r,n,o){var a=e("<"+i+">"+n+"</"+o+">"),s=e(t)[0].attributes,l={};e.each(s,function(e,t){'"'!==t.nodeName&&(l[t.nodeName]=t.nodeValue)}),e.each(l,function(e){0===e.indexOf("on")&&delete l[e]}),a.attr(l);var c="undefined"!=typeof a[1]?e(a[1]).text():"";return a[0].outerHTML+c}):t.replace(c,function(t,i,r,n){var a=o.split(","),s=e(t);return s.html(n),e.each(a,function(e){s.attr(a[e],null)}),s[0].outerHTML})}return t},t.markdownToHTML=function(i,r){var n={gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:"目录",tocDropdown:!1,tocContainer:"",markdown:"",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0};t.$marked=marked;var o=e("#"+i),a=o.settings=e.extend(!0,n,r||{}),s=o.find("textarea");s.length<1&&(o.append("<textarea></textarea>"),s=o.find("textarea"));var l=""===a.markdown?s.val():a.markdown,c=[],h={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,taskList:a.taskList,emoji:a.emoji,tex:a.tex,pageBreak:a.pageBreak,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},u={renderer:t.markedRenderer(c,h),gfm:a.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:!a.htmlDecode,smartLists:!0,smartypants:!0};l=new String(l);var d=marked(l,u);d=t.filterHTMLTags(d,a.htmlDecode),a.markdownSourceCode?s.text(l):s.remove(),o.addClass("markdown-body "+this.classPrefix+"html-preview").append(d);var f=""!==a.tocContainer?e(a.tocContainer):o;if(""!==a.tocContainer&&f.attr("previewContainer",!1),a.toc&&(o.tocContainer=this.markdownToCRenderer(c,f,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||o.find("."+this.classPrefix+"toc-menu").length>0)&&this.tocDropdownMenu(o,a.tocTitle),""!==a.tocContainer&&o.find(".editormd-toc-menu, .editormd-markdown-toc").remove()),a.previewCodeHighlight&&(o.find("pre").addClass("prettyprint linenums"),prettyPrint()),t.isIE8||(a.flowChart&&o.find(".flowchart").flowChart(),a.sequenceDiagram&&o.find(".sequence-diagram").sequenceDiagram({theme:"simple"})),a.tex){var p=function(){o.find("."+t.classNames.tex).each(function(){var t=e(this);katex.render(t.html().replace(/&lt;/g,"<").replace(/&gt;/g,">"),t[0]),t.find(".katex").css("font-size","1.6em")})};!a.autoLoadKaTeX||t.$katex||t.kaTeXLoaded?p():this.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,p()})}return o.getMarkdown=function(){return s.val()},o},t.themes=["default","dark"],t.previewThemes=["default","dark"],t.editorThemes=["default","3024-day","3024-night","ambiance","ambiance-mobile","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","mdn-like","midnight","monokai","neat","neo","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized","the-matrix","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark","xq-light"],t.loadPlugins={},t.loadFiles={js:[],css:[],plugin:[]},t.loadPlugin=function(e,i,r){i=i||function(){},this.loadScript(e,function(){t.loadFiles.plugin.push(e),i()},r)},t.loadCSS=function(e,i,r){r=r||"head",i=i||function(){};var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.onload=n.onreadystatechange=function(){t.loadFiles.css.push(e),i()},n.href=e+".css","head"===r?document.getElementsByTagName("head")[0].appendChild(n):document.body.appendChild(n)},t.isIE="Microsoft Internet Explorer"==navigator.appName,t.isIE8=t.isIE&&"8."==navigator.appVersion.match(/8./i),t.loadScript=function(e,i,r){r=r||"head",i=i||function(){};var n=null;n=document.createElement("script"),n.id=e.replace(/[\.\/]+/g,"-"),n.type="text/javascript",n.src=e+".js",t.isIE8?n.onreadystatechange=function(){n.readyState&&("loaded"!==n.readyState&&"complete"!==n.readyState||(n.onreadystatechange=null,t.loadFiles.js.push(e),i()))}:n.onload=function(){t.loadFiles.js.push(e),i()},"head"===r?document.getElementsByTagName("head")[0].appendChild(n):document.body.appendChild(n)},t.katexURL={css:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min",js:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min"},t.kaTeXLoaded=!1,t.loadKaTeX=function(e){t.loadCSS(t.katexURL.css,function(){t.loadScript(t.katexURL.js,e||function(){})})},t.lockScreen=function(t){e("html,body").css("overflow",t?"hidden":"")},t.createDialog=function(i){var r={name:"",width:420,height:240,title:"",drag:!0,closed:!0,content:"",mask:!0,maskStyle:{backgroundColor:"#fff",opacity:.1},lockScreen:!0,footer:!0,buttons:!1};i=e.extend(!0,r,i);var n=this,o=this.editor,a=t.classPrefix,s=(new Date).getTime(),l=""===i.name?a+"dialog-"+s:i.name,c=t.mouseOrTouch,h='<div class="'+a+"dialog "+l+'">';""!==i.title&&(h+='<div class="'+a+'dialog-header"'+(i.drag?' style="cursor: move;"':"")+">",h+='<strong class="'+a+'dialog-title">'+i.title+"</strong>",h+="</div>"),i.closed&&(h+='<a href="javascript:;" class="fa fa-close '+a+'dialog-close"></a>'),h+='<div class="'+a+'dialog-container">'+i.content,(i.footer||"string"==typeof i.footer)&&(h+='<div class="'+a+'dialog-footer">'+("boolean"==typeof i.footer?"":i.footer)+"</div>"),h+="</div>",h+='<div class="'+a+"dialog-mask "+a+'dialog-mask-bg"></div>',h+='<div class="'+a+"dialog-mask "+a+'dialog-mask-con"></div>',h+="</div>",o.append(h);var u=o.find("."+l);u.lockScreen=function(t){return i.lockScreen&&(e("html,body").css("overflow",t?"hidden":""),n.resize()),u},u.showMask=function(){return i.mask&&o.find("."+a+"mask").css(i.maskStyle).css("z-index",t.dialogZindex-1).show(),u},u.hideMask=function(){return i.mask&&o.find("."+a+"mask").hide(),u},u.loading=function(e){var t=u.find("."+a+"dialog-mask");return t[e?"show":"hide"](),u},u.lockScreen(!0).showMask(),u.show().css({zIndex:t.dialogZindex,border:t.isIE8?"1px solid #ddd":"",width:"number"==typeof i.width?i.width+"px":i.width,height:"number"==typeof i.height?i.height+"px":i.height});var d=function(){u.css({top:(e(window).height()-u.height())/2+"px",left:(e(window).width()-u.width())/2+"px"})};if(d(),e(window).resize(d),u.children("."+a+"dialog-close").bind(c("click","touchend"),function(){u.hide().lockScreen(!1).hideMask()}),"object"==typeof i.buttons){var f=u.footer=u.find("."+a+"dialog-footer");for(var p in i.buttons){var g=i.buttons[p],m=a+p+"-btn";f.append('<button class="'+a+"btn "+m+'">'+g[0]+"</button>"),g[1]=e.proxy(g[1],u),f.children("."+m).bind(c("click","touchend"),g[1])}}if(""!==i.title&&i.drag){var v,w,y=u.children("."+a+"dialog-header");i.mask||y.bind(c("click","touchend"),function(){t.dialogZindex+=2,u.css("z-index",t.dialogZindex)}),y.mousedown(function(e){e=e||window.event,v=e.clientX-parseInt(u[0].style.left),w=e.clientY-parseInt(u[0].style.top),document.onmousemove=C});var b=function(e){e.removeClass(a+"user-unselect").off("selectstart")},x=function(e){e.addClass(a+"user-unselect").on("selectstart",function(e){return!1})},C=function(t){t=t||window.event;var i,r,n=parseInt(u[0].style.left),o=parseInt(u[0].style.top);n>=0?n+u.width()<=e(window).width()?i=t.clientX-v:(i=e(window).width()-u.width(),document.onmousemove=null):(i=0,document.onmousemove=null),o>=0?r=t.clientY-w:(r=0,document.onmousemove=null),document.onselectstart=function(){return!1},x(e("body")),x(u),u[0].style.left=i+"px",u[0].style.top=r+"px"};document.onmouseup=function(){b(e("body")),b(u),document.onselectstart=null,document.onmousemove=null},y.touchDraggable=function(){var t=null,i=function(i){var r=i.originalEvent,n=e(this).parent().position();t={x:r.changedTouches[0].pageX-n.left,y:r.changedTouches[0].pageY-n.top}},r=function(i){i.preventDefault();var r=i.originalEvent;e(this).parent().css({top:r.changedTouches[0].pageY-t.y,left:r.changedTouches[0].pageX-t.x})};this.bind("touchstart",i).bind("touchmove",r)},y.touchDraggable()}return t.dialogZindex+=2,u},t.mouseOrTouch=function(e,t){e=e||"click",t=t||"touchend";var i=e;try{document.createEvent("TouchEvent"),i=t}catch(r){}return i},t.dateFormat=function(e){e=e||"";var t=function(e){return 10>e?"0"+e:e},i=new Date,r=i.getFullYear(),n=r.toString().slice(2,4),o=t(i.getMonth()+1),a=t(i.getDate()),s=i.getDay(),l=t(i.getHours()),c=t(i.getMinutes()),h=t(i.getSeconds()),u=t(i.getMilliseconds()),d="",f=n+"-"+o+"-"+a,p=r+"-"+o+"-"+a,g=l+":"+c+":"+h;switch(e){case"UNIX Time":d=i.getTime();break;case"UTC":d=i.toUTCString();break;case"yy":d=n;break;case"year":case"yyyy":d=r;break;case"month":case"mm":d=o;break;case"cn-week-day":case"cn-wd":var m=["日","一","二","三","四","五","六"];d="星期"+m[s];break;case"week-day":case"wd":var v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];d=v[s];break;case"day":case"dd":d=a;break;case"hour":case"hh":d=l;break;case"min":case"ii":d=c;break;case"second":case"ss":d=h;break;case"ms":d=u;break;case"yy-mm-dd":d=f;break;case"yyyy-mm-dd":d=p;break;case"yyyy-mm-dd h:i:s ms":case"full + ms":d=p+" "+g+" "+u;break;case"full":case"yyyy-mm-dd h:i:s":default:d=p+" "+g}return d},t}});